<div class="card">
  <p-toast />
  <p-table
    [value]="rows"
    dataKey="week"
    [tableStyle]="{ 'min-width': '60rem' }"
    [expandedRowKeys]="expandedRows"
    (onRowExpand)="onRowExpand($event)"
    (onRowCollapse)="onRowCollapse($event)"
  >
    <ng-template #caption>
      <div class="flex flex-wrap justify-end gap-2">
        <p-button label="" icon="pi pi-expand" (onClick)="expandAll()" />
        <p-button label="" icon="pi pi-arrow-down-left-and-arrow-up-right-to-center" text (onClick)="collapseAll()" />
      </div>
    </ng-template>
    <ng-template #header>
      <tr>
        <th style="width: 5rem"></th>
        <th pSortableColumn="week">
          Week
          <p-sortIcon field="name" />
        </th>
        <th>Size</th>
      </tr>
    </ng-template>
    <ng-template #body let-row let-expanded="expanded">
      <tr>
        <td>
          <p-button
            type="button"
            pRipple
            [pRowToggler]="row"
            [text]="true"
            [rounded]="true"
            [plain]="true"
            [icon]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'"
          />
        </td>
        <td>{{ row.week }}</td>
        <td>{{ getLength(row.week) }}</td>
      </tr>
    </ng-template>
    <ng-template #expandedrow let-row>
      <tr>
        <td colspan="7">
          <div class="p-4">
            <p-table [value]="row.records" dataKey="visit_record_id">
              <ng-template #header>
                <tr>
                  <th pSortableColumn="week">
                    Tuần
                    <p-sortIcon field="week" />
                  </th>
                  <th pSortableColumn="hospital">
                    Bệnh viện
                    <p-sortIcon field="hospital" />
                  </th>
                  <th pSortableColumn="visit_doctor_date">
                    Ngày khám
                    <p-sortIcon field="visit_doctor_date" />
                  </th>
                  <th pSortableColumn="next_visit_doctor_date">
                    Ngày tái khám
                    <p-sortIcon field="next_visit_doctor_date" />
                  </th>
                  <th pSortableColumn="doctor_name">
                    Bác sĩ
                    <p-sortIcon field="doctor_name" />
                  </th>
                  <th style="width: 4rem"></th>
                </tr>
              </ng-template>
              <ng-template #body let-record>
                <tr>
                  <td>{{ record.week }}</td>
                  <td>{{ record.hospital.name }}</td>
                  <td>{{ record.visit_doctor_date | date }}</td>
                  <td>{{ record.next_visit_doctor_date | date }}</td>
                  <td>{{ record.doctor_name }}</td>
                  <td>
                    <p-button (click)="editTracking(record.visit_record_id)" type="button" icon="pi pi-ellipsis-h" />
                  </td>
                </tr>
              </ng-template>
              <ng-template #emptymessage>
                <tr>
                  <td colspan="6">There is no record in this week yet.</td>
                </tr>
              </ng-template>
            </p-table>
          </div>
        </td>
      </tr>
    </ng-template>
  </p-table>
</div>
